<div class="modal fade" id="nuevoGastoModal" tabindex="-1" aria-labelledby="nuevoGastoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="nuevoGastoModalLabel">Nuevo Gasto</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" action="{% url 'crear_gasto' %}" id="formNuevoGasto">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="categoria">Categoría:</label>
                        <select class="form-control" id="categoria" name="categoria">
                            {% for categoria in categorias %}
                                <option value="{{ categoria.id }}">{{ categoria.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="descripcion">Descripción:</label>
                        <input type="text" class="form-control" id="descripcion" name="descripcion">
                    </div>
                    <div class="mb-3">
                        <label for="precio">Precio:</label>
                        <input type="text" class="form-control" id="precio" name="precio" oninput="validarPrecio(this)">
                    </div>
                    <div class="mb-3">
                        <label for="fecha">Fecha:</label>
                        <input type="date" class="form-control" id="fecha" name="fecha">
                    </div>
                    <div class="mb-3">
                        <label>Cuentas:</label>
                        {% for cuenta in cuentas %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="cuenta_{{ cuenta.id }}" name="cuentas" value="{{ cuenta.id }}">
                                <label class="form-check-label" for="cuenta_{{ cuenta.id }}">
                                    {{ cuenta.nombre }}
                                </label>
                            </div>
                        {% endfor %}
                    </div>
                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Agregar Gasto</button>
                </div>
            </form>          
        </div>
    </div>
</div>

<script>
    var formulario = document.getElementById('formNuevoGasto');
    var alerta = false;

    if (formulario) {
        formulario.addEventListener('submit', function(event) {
            
            var checkboxes = document.querySelectorAll('[name="cuentas"]:checked');

            if (checkboxes.length === 0 && !alerta) {
                alert('Elegi una cuenta por lo menos');
                event.preventDefault();
                alerta = true;
            }
        });
    }
</script>

<script>
    function validarPrecio(input) {
        var regex = /^(\d+([,.]\d{0,2})?|\.\d{1,2})$/;
        var valor = input.value;
        valor = valor.replace(',', '.');

        if (!regex.test(valor)) {
            alert('Solo numeros.');
            input.value = '';
        }
    }
</script>

